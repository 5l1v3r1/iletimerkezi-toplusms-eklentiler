<?xml version="1.0" encoding="UTF-8"?>
<modification>
        <id>Adding menu sms gönder</id>
        <version>1.0.0</version>
        <vqmver>1.0.9</vqmver>
        <author>ahk</author>
        
        
        <file name="catalog/controller/checkout/success.php">
                <operation>
                
                        <search position="before"><![CDATA[
                      

                        //Send sms catalog
                       

                        ]]></search>
                        
                        <add><![CDATA[
                        /*

                        ]]></add>
                        
                </operation>
        </file>
                <file name="catalog/controller/checkout/success.php">
                <operation>
                
                        <search position="before"><![CDATA[
                        unset($this->session->data['shipping_method']);

                        ]]></search>
                        
                        <add><![CDATA[
                        */

                        ]]></add>
                        
                </operation>
        </file>
            <file name="catalog/controller/checkout/success.php">
                <operation>
                
                        <search position="before"><![CDATA[
                        unset($this->session->data['shipping_method']);

                        ]]></search>
                        
                        <add><![CDATA[
                       //Send sms catalog
                        if(isset($message_info['iletimerkezi_order_customer_notify_text'])) {
                            $this->load->model('account/customer');
                            if ($this->customer->isLogged()) {
                            $customer_info = $this->model_account_customer->getCustomer($this->session->data['customer_id']);
                            $telephone = $customer_info['telephone'];
                            $order_id = $this->session->data['order_id'];
                        }else{
                            $telephone = $this->session->data['guest']['telephone'];
                            $order_id = $this->session->data['order_id'];
                        }
                            $message       = str_replace(array('%orderid%','%productname%','%productmodel%','%productquantity%'),array($order_id,$product_name,$product_model,$product_quantity),$message_info['iletimerkezi_order_customer_notify_text']);
                            $sms->send($message_info['iletimerkezi_username'],$message_info['iletimerkezi_password'],$message,$telephone,$message_info['iletimerkezi_originator']);
                        }

                        ]]></add>
                        
                </operation>
        </file>        
        
        <file name="admin/controller/common/header.php">
                <operation>
                
                        <search position="after"><![CDATA[
                        $this->data['text_setting'] = $this->language->get('text_setting');
                        ]]></search>
                        
                        <add><![CDATA[
                         $this->data['text_sms'] = $this->language->get('text_sms');
                        ]]></add>
                        
                </operation>
        </file>
                <file name="admin/controller/common/header.php">
                <operation>
                
                        <search position="after"><![CDATA[
                        $this->data['contact'] = HTTPS_SERVER . 'index.php?route=sale/contact&token=' . $this->session->data['token'];
                        ]]></search>
                        
                        <add><![CDATA[
                        $this->data['sms'] = HTTPS_SERVER . 'index.php?route=sale/sms&token=' . $this->session->data['token'];

                        ]]></add>
                        
                </operation>
        </file>
                <file name="admin/view/template/common/header.tpl">
                <operation>
                
                        <search position="after"><![CDATA[
                        <li><a href="<?php echo $contact; ?>"><?php echo $text_contact; ?></a></li>
                        ]]></search>
                        
                        <add><![CDATA[
                         <li><a href="<?php echo $sms; ?>"><?php echo $text_sms; ?></a></li>
                        ]]></add>
                        
                </operation>
        </file>
                <file name="admin/language/english/common/header.php">
                <operation>
                
                        <search position="before"><![CDATA[
                        $_['text_stock_status']
                        ]]></search>
                        
                        <add><![CDATA[
                         $_['text_sms']                                            = 'SMS Gönder';
                        ]]></add>
                        
                </operation>
        </file>
                <file name="admin/language/turkish/common/header.php">
                <operation>
                
                        <search position="before"><![CDATA[
                        $_['text_stock_status']
                        ]]></search>
                        
                        <add><![CDATA[
                         $_['text_sms']                                                 = 'SMS Gönder';
                        ]]></add>
                        
                </operation>
        </file>
        <file name="admin/model/sale/customer.php">
                <operation>
                
                        <search position="before"><![CDATA[
                        public function getAddresses($keyword)
                        ]]></search>
                        
                        <add><![CDATA[
                        public function getTelephoneByProduct($product_id) {
                            if ($product_id) {
                                $query = $this->db->query("SELECT * FROM `" . DB_PREFIX . "order` o LEFT JOIN " . DB_PREFIX . "order_product op ON (o.order_id = op.order_id) WHERE op.product_id = '" . (int)$product_id . "' AND o.order_status_id <> '0'");
                        
                                return $query->rows;
                            } else {
                                return array(); 
                            }
                        }
                        ]]></add>
                        
                </operation>
        </file>

</modification>